{%- macro linkify(href, title, tabindex=null) %}
  <a
    href="{{ href }}"
    title="View {{ title }}"
    {%- if tabindex %} tabindex="{{ tabindex }}"{% endif %}>
    {{- caller() -}}
  </a>
{% endmacro -%}

{%- macro githubify(list, repo) %}
  {%- set list -%}
    {%- for item in list -%}
      {% if loop.last %}and {% endif %}{{ item }}{% if not loop.last %}, {% endif %}
    {%- endfor -%}
  {%- endset -%}
  {%- set label = "View code on GitHub: " + list -%}
  <a
    aria-label="{{ label }}"
    class="repo"
    href="{{ repo }}"
    title="{{ label }}">
    <svg aria-hidden="true" viewbox="0 0 24 24">
      <path d="{{ icons['github'] }}"/>
    </svg>
  </a>
{% endmacro -%}

{% for section in projects -%}
<details id="{{ section.id }}">
  <summary>
    <h3>{{ section.heading }}</h3>  
  </summary>

  <p>{{ section.description }}</p>

  <ul role="list" class="projects">
  {% for project in section.items -%}
    <li>
      <figure>
        {%- call linkify(project.url, project.heading, -1) -%}
          <img src="/img/{{ project.img }}" alt="">
        {%- endcall -%}
        <figcaption>
          <h3>
            {%- call linkify(project.url, project.heading) -%}
              {{- project.heading -}}
            {%- endcall -%}
          </h3>
          <p>{{ project.copy }}</p>
          {%- if project.repo -%}
            {{ githubify(project.tags, project.repo) }}
          {%- endif -%}
        </figcaption>
      </figure>
    </li>
  {%- endfor %}
  </ul>
</details>
{%- endfor %}
